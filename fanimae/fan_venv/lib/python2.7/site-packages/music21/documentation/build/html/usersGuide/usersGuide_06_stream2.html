<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>User’s Guide, Chapter 6: Streams (II): Hierarchies, Recursion, and Flattening &mdash; music21 Documentation</title>
    
    <link rel="stylesheet" href="../_static/m21.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="top" title="music21 Documentation" href="../index.html" />
    <link rel="up" title="User’s Guide" href="index.html" />
    <link rel="next" title="User’s Guide, Chapter 7: Chords" href="usersGuide_07_chords.html" />
    <link rel="prev" title="User’s Guide, Chapter 5: Lists of Lists, Functions, and Recursion" href="usersGuide_05_listsOfLists.html" /><link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'>
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="usersGuide_07_chords.html" title="User’s Guide, Chapter 7: Chords"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="usersGuide_05_listsOfLists.html" title="User’s Guide, Chapter 5: Lists of Lists, Functions, and Recursion"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">music21</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">User&#8217;s Guide</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="usersGuide_05_listsOfLists.html"
                        title="previous chapter">User&#8217;s Guide, Chapter 5: Lists of Lists, Functions, and Recursion</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="usersGuide_07_chords.html"
                        title="next chapter">User&#8217;s Guide, Chapter 7: Chords</a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">User&#8217;s Guide, Chapter 6: Streams (II): Hierarchies, Recursion, and Flattening</a><ul>
<li><a class="reference internal" href="#classes-and-subclasses">Classes and Subclasses</a></li>
<li><a class="reference internal" href="#accessing-scores-parts-measures-and-notes">Accessing Scores, Parts, Measures, and Notes</a></li>
<li><a class="reference internal" href="#recursion-in-streams">Recursion in Streams</a></li>
<li><a class="reference internal" href="#flattening-a-stream">Flattening a Stream</a></li>
</ul>
</li>
</ul>

<h3><a href="../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About Music21</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User&#8217;s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="usersGuide_99_Table_of_Contents.html">User&#8217;s Guide: Table of Contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_01_installing.html">User&#8217;s Guide, Chapter 1: Installing and Getting Started with <code class="docutils literal"><span class="pre">music21</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_02_notes.html">User&#8217;s Guide, Chapter 2: Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_03_pitches.html">User&#8217;s Guide, Chapter 3: Pitches, Durations, and Notes again</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_04_stream1.html">User&#8217;s Guide, Chapter 4: Lists, Streams (I) and Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_05_listsOfLists.html">User&#8217;s Guide, Chapter 5: Lists of Lists, Functions, and Recursion</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">User&#8217;s Guide, Chapter 6: Streams (II): Hierarchies, Recursion, and Flattening</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_07_chords.html">User&#8217;s Guide, Chapter 7: Chords</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_08_installingMusicXML.html">User&#8217;s Guide, Chapter 8: Installing MusicXML Readers and File Formats (1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_09_chordify.html">User&#8217;s Guide, Chapter 9: Chordify</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_10_examples1.html">User&#8217;s Guide, Chapter 10: Examples 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_11_corpusSearching.html">User&#8217;s Guide, Chapter 11: Corpus Searching</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_12_music21object.html">User&#8217;s Guide, Chapter 12: Getting Back to Basics: The Music21Object</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_14_timeSignatures.html">User&#8217;s Guide: Chapter 14: Time Signatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_17_derivations.html">User&#8217;s Guide: Chapter 17: Derivations</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_21_sorting.html">User&#8217;s Guide, Chapter 21: Ordering and Sorting of Stream Elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_22_graphing.html">User’s Guide, Chapter 22: Graphing</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_23_advancedCorpus.html">User&#8217;s Guide, Chapter 23: Advanced Corpus and Metadata Searching</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_25_postTonalTools1.html">User&#8217;s Guide, Chapter 25: Post-Tonal Tools (1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_26_clientWeakref.html">User&#8217;s Guide, Chapter 26: Clients and Weak References.</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_54_extendingConverter.html">User&#8217;s Guide: Chapter 54: Extending Converter with New Formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_55_advancedMeter.html">User&#8217;s Guide: Chapter 55: Advanced Meter Topics</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../moduleReference/index.html">Module Reference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installing/index.html">Installation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developerReference/index.html">Developer Reference</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/usersGuide/usersGuide_06_stream2.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <span class="target" id="usersguide-06-stream2"></span><div class="section" id="user-s-guide-chapter-6-streams-ii-hierarchies-recursion-and-flattening">
<h1>User&#8217;s Guide, Chapter 6: Streams (II): Hierarchies, Recursion, and Flattening<a class="headerlink" href="#user-s-guide-chapter-6-streams-ii-hierarchies-recursion-and-flattening" title="Permalink to this headline">¶</a></h1>
<p>We ended Chapter 4 (<a class="reference internal" href="usersGuide_04_stream1.html#usersguide-04-stream1"><span>Streams (I)</span></a>.) with
a <a class="reference internal" href="../moduleReference/moduleStream.html#music21.stream.Stream" title="music21.stream.Stream"><code class="xref py py-class docutils literal"><span class="pre">Stream</span></code></a> that was contained within another
<code class="docutils literal"><span class="pre">Stream</span></code> object. Let&#8217;s recreate that class:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">music21</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">note1</span> <span class="o">=</span> <span class="n">note</span><span class="o">.</span><span class="n">Note</span><span class="p">(</span><span class="s">&quot;C4&quot;</span><span class="p">)</span>
<span class="n">note1</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&#39;half&#39;</span>
<span class="n">note2</span> <span class="o">=</span> <span class="n">note</span><span class="o">.</span><span class="n">Note</span><span class="p">(</span><span class="s">&quot;F#4&quot;</span><span class="p">)</span>
<span class="n">note3</span> <span class="o">=</span> <span class="n">note</span><span class="o">.</span><span class="n">Note</span><span class="p">(</span><span class="s">&quot;B-2&quot;</span><span class="p">)</span>

<span class="n">stream1</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">Stream</span><span class="p">()</span>
<span class="n">stream1</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s">&#39;some notes&#39;</span>
<span class="n">stream1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">note1</span><span class="p">)</span>
<span class="n">stream1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">note2</span><span class="p">)</span>
<span class="n">stream1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">note3</span><span class="p">)</span>

<span class="n">biggerStream</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">Stream</span><span class="p">()</span>
<span class="n">note2</span> <span class="o">=</span> <span class="n">note</span><span class="o">.</span><span class="n">Note</span><span class="p">(</span><span class="s">&quot;D#5&quot;</span><span class="p">)</span>
<span class="n">biggerStream</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">note2</span><span class="p">)</span>
<span class="n">biggerStream</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stream1</span><span class="p">)</span>
</pre></div>
</div>
<p>The only way to find out what was in the contained Stream that we
demonstrated so far was the <a class="reference internal" href="../moduleReference/moduleBase.html#music21.base.Music21Object.show" title="music21.base.Music21Object.show"><code class="xref py py-meth docutils literal"><span class="pre">show()</span></code></a>
method using the <code class="docutils literal"><span class="pre">('text')</span></code> argument.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">biggerStream</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s">&#39;text&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> {0.0} &lt;music21.note.Note D#&gt;
 {1.0} &lt;music21.stream.Stream some notes&gt;
     {0.0} &lt;music21.note.Note C&gt;
     {2.0} &lt;music21.note.Note F#&gt;
     {3.0} &lt;music21.note.Note B-&gt;
</pre></div>
</div>
<p>As Chapter 4 noted, there&#8217;s a way to reach the inner notes such as
<code class="docutils literal"><span class="pre">F#</span></code> via the <code class="docutils literal"><span class="pre">biggerStream[1][2]</span></code> format, but there&#8217;s a better way
to do that in music21, and for that we need to learn about subclasses of
Streams and subclasses in general. (Skip this if you already know about
such things from other programming experience)</p>
<div class="section" id="classes-and-subclasses">
<h2>Classes and Subclasses<a class="headerlink" href="#classes-and-subclasses" title="Permalink to this headline">¶</a></h2>
<p>An object, such as a note or pitch, is basically a collection of
information along with some actions that can be performed on that
information. A class is something that can make new objects of a certain
type (sometimes this is called a factory). We&#8217;ve seen classes such as
the <code class="docutils literal"><span class="pre">note.Note</span></code> class, where the lowercase <code class="docutils literal"><span class="pre">note</span></code> is the &#8220;module&#8221;
that the class <code class="docutils literal"><span class="pre">Note</span></code> lives in:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">note</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> &lt;module &#39;music21.note&#39; from &#39;/Users/cuthbert/music21/note.py&#39;&gt;
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">Note</span><span class="p">)</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> &lt;class &#39;music21.note.Note&#39;&gt;
</pre></div>
</div>
<p>We create an object from a class by using the class name with <code class="docutils literal"><span class="pre">()</span></code>
after it:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">n</span> <span class="o">=</span> <span class="n">note</span><span class="o">.</span><span class="n">Note</span><span class="p">()</span>
<span class="n">n</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> &lt;music21.note.Note C&gt;
</pre></div>
</div>
<p>As we&#8217;ve seen, we can sometimes put additional information into the
<code class="docutils literal"><span class="pre">()</span></code>, such as a pitch name in the case of a <code class="docutils literal"><span class="pre">Note</span></code>:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">d</span> <span class="o">=</span> <span class="n">note</span><span class="o">.</span><span class="n">Note</span><span class="p">(</span><span class="s">&#39;D#5&#39;</span><span class="p">)</span>
<span class="n">d</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> &lt;music21.note.Note D#&gt;
</pre></div>
</div>
<p>The variable <code class="docutils literal"><span class="pre">d</span></code> is now a <code class="docutils literal"><span class="pre">Note</span></code> object created from the <code class="docutils literal"><span class="pre">Note</span></code>
class. It&#8217;s all a bit confusing, I know. But we&#8217;ll get to the point in a
second. If you want to find out more about what a <code class="docutils literal"><span class="pre">Note</span></code> object can
do, the best thing is to read the <code class="docutils literal"><span class="pre">music21</span></code> instruction manual. :-)
But for any class in Python, you can use the function <code class="docutils literal"><span class="pre">help(Class)</span></code> to
find out what it can do:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">help</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">Note</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Help on class Note in module music21.note:

class Note(NotRest)
|  One of the most important music21 classes, a Note
|  stores a single note (that is, not a rest or an unpitched element)
|  that can be represented by one or more notational units -- so
|  for instance a C quarter-note and a D# eighth-tied-to-32nd are both
|  a single Note object.
|
|  *** ............ ***
|
|  Method resolution order:
|      Note
|      NotRest
|      GeneralNote
|      music21.base.Music21Object
|      builtins.object
</pre></div>
</div>
<p>Notice towards the very top there&#8217;s the line <code class="docutils literal"><span class="pre">class</span> <span class="pre">Note(NotRest)</span></code>.
This says that the <code class="docutils literal"><span class="pre">Note</span></code> class is a &#8220;subclass&#8221; of a class called
<code class="docutils literal"><span class="pre">NotRest</span></code> which contains all the information for note-like things such
as <code class="docutils literal"><span class="pre">Note</span></code>, <code class="docutils literal"><span class="pre">Unpitched</span></code> percussion, and <code class="docutils literal"><span class="pre">Chord</span></code> that have stems,
beams, etc. and are, well, not rests. (Chris Ariza and I spent over an
hour trying to come up with a better name for these things, but in the
end we couldn&#8217;t come up with anything better than <code class="docutils literal"><span class="pre">NotRest</span></code>, so it&#8217;s
stuck).</p>
<p>What does it mean for <code class="docutils literal"><span class="pre">Note</span></code> to be a subclass of <code class="docutils literal"><span class="pre">NotRest</span></code>? It means
that everything that <code class="docutils literal"><span class="pre">NotRest</span></code> can do, <code class="docutils literal"><span class="pre">Note</span></code> can do, and more. For
instance, <code class="docutils literal"><span class="pre">NotRest</span></code> has a <code class="docutils literal"><span class="pre">.beams</span></code> property, so so does <code class="docutils literal"><span class="pre">Note</span></code>:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">nr</span> <span class="o">=</span> <span class="n">note</span><span class="o">.</span><span class="n">NotRest</span><span class="p">()</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">note</span><span class="o">.</span><span class="n">Note</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">nr</span><span class="o">.</span><span class="n">beams</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">beams</span><span class="p">)</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> &lt;music21.beam.Beams &gt; &lt;music21.beam.Beams &gt;
</pre></div>
</div>
<p>But <code class="docutils literal"><span class="pre">Rest</span></code> is not a subclass of <code class="docutils literal"><span class="pre">NotRest</span></code> for obvious reasons. So a
rest doesn&#8217;t know anything about beams:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">r</span> <span class="o">=</span> <span class="n">note</span><span class="o">.</span><span class="n">Rest</span><span class="p">()</span>
<span class="n">r</span><span class="o">.</span><span class="n">beams</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>---------------------------------------------------------------------------

AttributeError                            Traceback (most recent call last)

&lt;ipython-input-10-9c62a1bd1707&gt; in &lt;module&gt;()
      1 r = note.Rest()
----&gt; 2 r.beams


AttributeError: &#39;Rest&#39; object has no attribute &#39;beams&#39;
</pre></div>
</div>
<p>But <code class="docutils literal"><span class="pre">Note</span></code> has properties that <code class="docutils literal"><span class="pre">NotRest</span></code> does not, such as
<code class="docutils literal"><span class="pre">.pitch</span></code>:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="n">nr</span><span class="o">.</span><span class="n">pitch</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>---------------------------------------------------------------------------

AttributeError                            Traceback (most recent call last)

&lt;ipython-input-11-b4fa4feba8cd&gt; in &lt;module&gt;()
----&gt; 1 print(nr.pitch)


AttributeError: &#39;NotRest&#39; object has no attribute &#39;pitch&#39;
</pre></div>
</div>
<p>So classes and subclasses are a great way of making sure that things
that are mostly similar have many of the same properties, but that they
can have their own distinct information (<code class="docutils literal"><span class="pre">attributes</span></code>) and actions
(<code class="docutils literal"><span class="pre">methods</span></code>). Just FYI, here&#8217;s how we create a subclass. We can create
a Class called <code class="docutils literal"><span class="pre">Japan</span></code> and then a subclass called <code class="docutils literal"><span class="pre">Okinawa</span></code> (my
ancestral home) which has an additional attribute.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Japan</span><span class="p">:</span>
    <span class="n">food</span> <span class="o">=</span> <span class="s">&quot;sushi&quot;</span>
    <span class="n">drink</span> <span class="o">=</span> <span class="s">&quot;sake&quot;</span>

<span class="k">class</span> <span class="nc">Okinawa</span><span class="p">(</span><span class="n">Japan</span><span class="p">):</span>
    <span class="n">evenBetterFood</span> <span class="o">=</span> <span class="s">&quot;spam_potstickers&quot;</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">(Japan)</span></code> in the class definition of <code class="docutils literal"><span class="pre">Okinawa</span></code> means that it
inherits everything that Japan has and more:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">o</span> <span class="o">=</span> <span class="n">Okinawa</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">food</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">drink</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">evenBetterFood</span><span class="p">)</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> sushi sake spam_potstickers
</pre></div>
</div>
<p>But the joy of spam gyoza has not come to the mainland yet:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">j</span> <span class="o">=</span> <span class="n">Japan</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">evenBetterFood</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>---------------------------------------------------------------------------

AttributeError                            Traceback (most recent call last)

&lt;ipython-input-14-e5f7b7ba97ec&gt; in &lt;module&gt;()
      1 j = Japan()
----&gt; 2 print(j.evenBetterFood)


AttributeError: &#39;Japan&#39; object has no attribute &#39;evenBetterFood&#39;
</pre></div>
</div>
<p>So this is how subclasses work in a nutshell. The first subclasses we
will be working with are the three fundamental subclasses of <code class="docutils literal"><span class="pre">Stream</span></code>:
<code class="docutils literal"><span class="pre">Score</span></code>, <code class="docutils literal"><span class="pre">Part</span></code>, and <code class="docutils literal"><span class="pre">Measure</span></code>.</p>
</div>
<div class="section" id="accessing-scores-parts-measures-and-notes">
<h2>Accessing Scores, Parts, Measures, and Notes<a class="headerlink" href="#accessing-scores-parts-measures-and-notes" title="Permalink to this headline">¶</a></h2>
<p>Streams provide a way to structure and position music21 objects both
hierarchically and temporally. A Stream, or a Stream subclass such as
<a class="reference internal" href="../moduleReference/moduleStream.html#music21.stream.Measure" title="music21.stream.Measure"><code class="xref py py-class docutils literal"><span class="pre">Measure</span></code></a>, can be placed within another Stream.</p>
<p>A common arrangement of nested Streams is a
<a class="reference internal" href="../moduleReference/moduleStream.html#music21.stream.Score" title="music21.stream.Score"><code class="xref py py-class docutils literal"><span class="pre">Score</span></code></a> Stream containing one or more
<a class="reference internal" href="../moduleReference/moduleStream.html#music21.stream.Part" title="music21.stream.Part"><code class="xref py py-class docutils literal"><span class="pre">Part</span></code></a> Streams, each Part Stream in turn
containing one or more <a class="reference internal" href="../moduleReference/moduleStream.html#music21.stream.Measure" title="music21.stream.Measure"><code class="xref py py-class docutils literal"><span class="pre">Measure</span></code></a> Streams.</p>
<p>Such an arrangement of Stream objects is the common way musical scores
are represented in music21. For example, importing a four-part chorale
by J. S. Bach will provide a Score object with four Part Streams, each
Part containing multiple Measure objects. Music21 comes with a
<a class="reference internal" href="../moduleReference/moduleCorpus.html#modulecorpus"><span>music21.corpus</span></a> module that provides access to a large collection
of scores, including all the Bach chorales. We can parse the score from
the corpus with the <a class="reference internal" href="../moduleReference/moduleCorpus.html#music21.corpus.parse" title="music21.corpus.parse"><code class="xref py py-func docutils literal"><span class="pre">parse()</span></code></a> function, which we
will discuss more in a bit.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">sBach</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s">&#39;bach/bwv57.8&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">We can access and examine elements at each level of this Score by
using standard Python syntax for lists within lists. Thus, we can see
the length of each component: first the Score which has five elements,
a <a class="reference internal" href="../moduleReference/moduleMetadata.html#music21.metadata.Metadata" title="music21.metadata.Metadata"><code class="xref py py-class docutils literal"><span class="pre">Metadata</span></code></a> object and four parts. Then we
find the length of first Part at index one which indicates 19 objects
(18 of them are measures).</div>
</div>
<div class="line-block">
<div class="line">Then within that part we find an object (a Measure) at index 1. All of
these subprograms can be accessed from looking within the same score
object <code class="docutils literal"><span class="pre">sBach</span></code>.</div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nb">len</span><span class="p">(</span><span class="n">sBach</span><span class="p">)</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> <span class="mi">6</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nb">len</span><span class="p">(</span><span class="n">sBach</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> <span class="mi">19</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nb">len</span><span class="p">(</span><span class="n">sBach</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> <span class="mi">6</span>
</pre></div>
</div>
<p>But how did we know that index [1] would be a Part and index [1][1]
would be a measure? As writers of the tutorial, we know this piece well
enough to know that. But as we noted above, more than just Measures
might be stored in a Part object (such as
<a class="reference internal" href="../moduleReference/moduleInstrument.html#music21.instrument.Instrument" title="music21.instrument.Instrument"><code class="xref py py-class docutils literal"><span class="pre">Instrument</span></code></a> objects), and more than just
Note and Rest objects might be stored in a Measure (such as
<a class="reference internal" href="../moduleReference/moduleMeter.html#music21.meter.TimeSignature" title="music21.meter.TimeSignature"><code class="xref py py-class docutils literal"><span class="pre">TimeSignature</span></code></a> and
<a class="reference internal" href="../moduleReference/moduleKey.html#music21.key.KeySignature" title="music21.key.KeySignature"><code class="xref py py-class docutils literal"><span class="pre">KeySignature</span></code></a> objects). We it&#8217;s much safer to
filter Stream and Stream subclasses by the class we seek.</p>
<p>To repeat the count and select specific classes, we can use the
<a class="reference internal" href="../moduleReference/moduleStream.html#music21.stream.Stream.getElementsByClass" title="music21.stream.Stream.getElementsByClass"><code class="xref py py-meth docutils literal"><span class="pre">getElementsByClass()</span></code></a> method that we
discussed in <a class="reference internal" href="usersGuide_04_stream1.html#usersguide-04-stream1"><span>Chapter 4</span></a>.</p>
<p>Notice how the counts deviate from the examples above.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nb">len</span><span class="p">(</span><span class="n">sBach</span><span class="o">.</span><span class="n">getElementsByClass</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">Part</span><span class="p">))</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> <span class="mi">4</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nb">len</span><span class="p">(</span><span class="n">sBach</span><span class="o">.</span><span class="n">getElementsByClass</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">Part</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getElementsByClass</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">Measure</span><span class="p">))</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> <span class="mi">18</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nb">len</span><span class="p">(</span><span class="n">sBach</span><span class="o">.</span><span class="n">getElementsByClass</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">Part</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getElementsByClass</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">Measure</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">getElementsByClass</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">Note</span><span class="p">))</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> <span class="mi">3</span>
</pre></div>
</div>
<p>Recall from <a class="reference internal" href="usersGuide_04_stream1.html#usersguide-04-stream1"><span>Chapter 4</span></a> that the
<a class="reference internal" href="../moduleReference/moduleStream.html#music21.stream.Stream.getElementsByClass" title="music21.stream.Stream.getElementsByClass"><code class="xref py py-meth docutils literal"><span class="pre">getElementsByClass()</span></code></a> method can also take
a string representation of the last section of the class name. Thus we
could&#8217;ve rewritten the first call above as:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nb">len</span><span class="p">(</span><span class="n">sBach</span><span class="o">.</span><span class="n">getElementsByClass</span><span class="p">(</span><span class="s">&#39;Part&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> <span class="mi">4</span>
</pre></div>
</div>
<p>This way of doing things is a bit faster to code, but a little less
safe. Suppose, for instance there were objects of type
<code class="docutils literal"><span class="pre">stream.Measure</span></code> and <code class="docutils literal"><span class="pre">tape.Measure</span></code>; the latter way of writing the
code would get both of them. (But this ambiguity is rare enough that
it&#8217;s safe enough to use the strings in most code.)</p>
<p>When we introduced <code class="docutils literal"><span class="pre">.getElementsByClass()</span></code> we also introduced the
convenience properties <code class="docutils literal"><span class="pre">.notes</span></code> and <code class="docutils literal"><span class="pre">.notesAndRests</span></code>. There is a
convenience property for getting parts out as well:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nb">len</span><span class="p">(</span><span class="n">sBach</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> <span class="mi">4</span>
</pre></div>
</div>
<p>You might think that there should be a convenience property
<code class="docutils literal"><span class="pre">.measures</span></code> to get all the measures. But the problem with that is that
measure numbers would be quite different from index numbers. For
instance, most pieces (that don&#8217;t have pickup measures) begin with
measure 1, not zero. Sometimes there are measure discontinuities within
a piece (e.g., some people number first and second endings with the same
measure number). For that reason, gathering Measures is best
accomplished not with <code class="docutils literal"><span class="pre">getElementsByClass(stream.Measure)</span></code> but instead
with either the <a class="reference internal" href="../moduleReference/moduleStream.html#music21.stream.Stream.measures" title="music21.stream.Stream.measures"><code class="xref py py-meth docutils literal"><span class="pre">measures()</span></code></a> method
(returning a Stream of Parts or Measures) or the
<a class="reference internal" href="../moduleReference/moduleStream.html#music21.stream.Stream.measure" title="music21.stream.Stream.measure"><code class="xref py py-meth docutils literal"><span class="pre">measure()</span></code></a> method (returning a single
Measure).</p>
<p>These are methods, not properties, so they use the <code class="docutils literal"><span class="pre">()</span></code> call. Let&#8217;s
look at how we might use them:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">alto</span> <span class="o">=</span> <span class="n">sBach</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c"># parts count from zero</span>
<span class="n">excerpt</span> <span class="o">=</span> <span class="n">alto</span><span class="o">.</span><span class="n">measures</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">excerpt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/usersGuide_06_stream2_48_0.png" src="../_images/usersGuide_06_stream2_48_0.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">measure2</span> <span class="o">=</span> <span class="n">alto</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c"># measure not measure_s_</span>
<span class="n">measure2</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/usersGuide_06_stream2_49_0.png" src="../_images/usersGuide_06_stream2_49_0.png" />
<p>What is great about <code class="docutils literal"><span class="pre">.measure()</span></code> and <code class="docutils literal"><span class="pre">.measures()</span></code> is that they can
work on a whole score and not just a single part. Sometimes
computational musicologists and programmers call a collection of
measures across parts a &#8220;measureStack&#8221;. So let&#8217;s get the measure stack
consisting of measure numbers 2 and 3 across all parts:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">measureStack</span> <span class="o">=</span> <span class="n">sBach</span><span class="o">.</span><span class="n">measures</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">measureStack</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/usersGuide_06_stream2_51_0.png" src="../_images/usersGuide_06_stream2_51_0.png" />
</div>
<div class="section" id="recursion-in-streams">
<h2>Recursion in Streams<a class="headerlink" href="#recursion-in-streams" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">Streams</span></code> are hierarchical objects where the contained elements can
themselves be Streams. In order to get at each lower layer of the
stream, a generator method on every stream called
<a class="reference internal" href="../moduleReference/moduleStream.html#music21.stream.Stream.recurse" title="music21.stream.Stream.recurse"><code class="xref py py-meth docutils literal"><span class="pre">recurse()</span></code></a> will visit every element in the
stream, starting from the beginning, and if any of the subelements are
also Streams, they will visit every element in that Stream.</p>
<p>Let&#8217;s create a simpler Stream to visualize what <code class="docutils literal"><span class="pre">.recurse()</span></code> does.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">s</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">Score</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s">&#39;mainScore&#39;</span><span class="p">)</span>
<span class="n">p0</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">Part</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s">&#39;part0&#39;</span><span class="p">)</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">Part</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s">&#39;part1&#39;</span><span class="p">)</span>

<span class="n">m01</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">m01</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">Note</span><span class="p">(</span><span class="s">&#39;C&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;whole&quot;</span><span class="p">))</span>
<span class="n">m02</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">m02</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">Note</span><span class="p">(</span><span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;whole&quot;</span><span class="p">))</span>
<span class="n">p0</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">m01</span><span class="p">,</span> <span class="n">m02</span><span class="p">])</span>

<span class="n">m11</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">m11</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">Note</span><span class="p">(</span><span class="s">&#39;E&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;whole&quot;</span><span class="p">))</span>
<span class="n">m12</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">m12</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">Note</span><span class="p">(</span><span class="s">&#39;F&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;whole&quot;</span><span class="p">))</span>
<span class="n">p1</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">m11</span><span class="p">,</span> <span class="n">m12</span><span class="p">])</span>

<span class="n">s</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p0</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s">&#39;text&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> {0.0} &lt;music21.stream.Part part0&gt;
     {0.0} &lt;music21.stream.Measure 1 offset=0.0&gt;
         {0.0} &lt;music21.note.Note C&gt;
     {4.0} &lt;music21.stream.Measure 2 offset=4.0&gt;
         {0.0} &lt;music21.note.Note D&gt;
 {0.0} &lt;music21.stream.Part part1&gt;
     {0.0} &lt;music21.stream.Measure 1 offset=0.0&gt;
         {0.0} &lt;music21.note.Note E&gt;
     {4.0} &lt;music21.stream.Measure 2 offset=4.0&gt;
         {0.0} &lt;music21.note.Note F&gt;
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">s</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/usersGuide_06_stream2_55_0.png" src="../_images/usersGuide_06_stream2_55_0.png" />
<p>Calling <code class="docutils literal"><span class="pre">.recurse()</span></code> on its own isn&#8217;t very useful.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">recurseScore</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recurse</span><span class="p">()</span>
<span class="n">recurseScore</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> &lt;music21.stream.iterator.RecursiveIterator at 0x105825e80&gt;
</pre></div>
</div>
<p>Where it becomes useful is in a <code class="docutils literal"><span class="pre">for</span></code> loop:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">recurse</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">activeSite</span><span class="p">)</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> 0.0 &lt;music21.stream.Score mainScore&gt; None
 0.0 &lt;music21.stream.Part part0&gt; &lt;music21.stream.Score mainScore&gt;
 0.0 &lt;music21.stream.Measure 1 offset=0.0&gt; &lt;music21.stream.Part part0&gt;
 0.0 &lt;music21.note.Note C&gt; &lt;music21.stream.Measure 1 offset=0.0&gt;
 4.0 &lt;music21.stream.Measure 2 offset=4.0&gt; &lt;music21.stream.Part part0&gt;
 0.0 &lt;music21.note.Note D&gt; &lt;music21.stream.Measure 2 offset=4.0&gt;
 0.0 &lt;music21.stream.Part part1&gt; &lt;music21.stream.Score mainScore&gt;
 0.0 &lt;music21.stream.Measure 1 offset=0.0&gt; &lt;music21.stream.Part part1&gt;
 0.0 &lt;music21.note.Note E&gt; &lt;music21.stream.Measure 1 offset=0.0&gt;
 4.0 &lt;music21.stream.Measure 2 offset=4.0&gt; &lt;music21.stream.Part part1&gt;
 0.0 &lt;music21.note.Note F&gt; &lt;music21.stream.Measure 2 offset=4.0&gt;
</pre></div>
</div>
<p>This example also introduces the concept of <code class="docutils literal"><span class="pre">.activeSite</span></code>, which for
now can be thought of as the Stream that the element lives in; though
we&#8217;ll find that <code class="docutils literal"><span class="pre">Notes</span></code> and other elements can be in multiple Streams
simultaneously, and this is just the one that they are most recently
associated with.</p>
<p>There are a lot of things that we can do with <code class="docutils literal"><span class="pre">.recurse()</span></code>, but let&#8217;s
just introduce one more thing for now. Most &#8220;filtering&#8221; mechanisms, such
as <code class="docutils literal"><span class="pre">.notes</span></code> can also be applied between the <code class="docutils literal"><span class="pre">()</span></code> of <code class="docutils literal"><span class="pre">recurse()</span></code>
and the <code class="docutils literal"><span class="pre">:</span></code> at the end:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">recurse</span><span class="p">()</span><span class="o">.</span><span class="n">notes</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">activeSite</span><span class="p">)</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> 0.0 &lt;music21.note.Note C&gt; &lt;music21.stream.Measure 1 offset=0.0&gt;
 0.0 &lt;music21.note.Note D&gt; &lt;music21.stream.Measure 2 offset=4.0&gt;
 0.0 &lt;music21.note.Note E&gt; &lt;music21.stream.Measure 1 offset=0.0&gt;
 0.0 &lt;music21.note.Note F&gt; &lt;music21.stream.Measure 2 offset=4.0&gt;
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><cite>.recurse()</cite> is a generator as of v2.0.10. Thus is can only be used in <cite>for</cite> loops and other things that
iterate over each member of a list.  To treat the results of <cite>.recurse()</cite> as a list, you need to wrap it</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">listRecurse</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sBach</span><span class="o">.</span><span class="n">recurse</span><span class="p">())</span>
</pre></div>
</div>
</div>
<p>In general, <code class="docutils literal"><span class="pre">.recurse()</span></code> is the best way to work through all the
elements of a Stream, but there is another way that can be handy in some
situations, and that is called <code class="docutils literal"><span class="pre">.flat</span></code>.</p>
</div>
<div class="section" id="flattening-a-stream">
<h2>Flattening a Stream<a class="headerlink" href="#flattening-a-stream" title="Permalink to this headline">¶</a></h2>
<p>While nested Streams offer expressive flexibility, it is often useful to
be able to flatten all Stream and Stream subclasses into a single Stream
containing only the elements that are not Stream subclasses. The
:attr:<code class="docutils literal"><span class="pre">~music21.stream.Stream.flat</span></code> property provides immediate access
to such a flat representation of a Stream. For example, doing a similar
count of components, such as that show above, we see that we cannot get
to all of the Note objects of a complete Score until we flatten its Part
and Measure objects by accessing the <code class="docutils literal"><span class="pre">flat</span></code> attribute. Note that for
historical reasons, <code class="docutils literal"><span class="pre">.flat</span></code> is a property, so you do not use <code class="docutils literal"><span class="pre">()</span></code>
around it.</p>
<p>Let&#8217;s look at what <code class="docutils literal"><span class="pre">.flat</span></code> does to the example score we created.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">activeSite</span><span class="p">)</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> 0.0 &lt;music21.note.Note C&gt; &lt;music21.stream.Score mainScore_flat&gt;
 0.0 &lt;music21.note.Note E&gt; &lt;music21.stream.Score mainScore_flat&gt;
 4.0 &lt;music21.note.Note D&gt; &lt;music21.stream.Score mainScore_flat&gt;
 4.0 &lt;music21.note.Note F&gt; &lt;music21.stream.Score mainScore_flat&gt;
</pre></div>
</div>
<p>A new, temporary <code class="docutils literal"><span class="pre">Stream</span></code> with <code class="docutils literal"><span class="pre">id</span></code> of &#8220;mainScore_flat&#8221; has been
created, and all of the <code class="docutils literal"><span class="pre">Note</span></code> objects are in there. We didn&#8217;t filter
out non-Notes: <code class="docutils literal"><span class="pre">.flat</span></code> automatically removes all <code class="docutils literal"><span class="pre">Stream</span></code> objects
and in this case there&#8217;s nothing else but Notes in there.</p>
<p>All the <code class="docutils literal"><span class="pre">Note</span></code> objects are now in the new temporary <code class="docutils literal"><span class="pre">mainScore_flat</span></code>
object, and their offsets are no longer all <code class="docutils literal"><span class="pre">0.0</span></code>, but are instead
measured from the start of the score being flattened. So the whole notes
in measure 2 are given offset <code class="docutils literal"><span class="pre">4.0</span></code></p>
<p>Compare what <code class="docutils literal"><span class="pre">.flat</span></code> lets you do when looking at a larger score.</p>
<p>There are no Notes in the sBach stream...</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nb">len</span><span class="p">(</span><span class="n">sBach</span><span class="o">.</span><span class="n">getElementsByClass</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">Note</span><span class="p">))</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> <span class="mi">0</span>
</pre></div>
</div>
<p>...they are all inside Measures inside Parts inside the stream. (in a
more complex score, they may be in Voices inside Measures inside Parts,
etc.). But they are all inside the flat version of the Stream:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nb">len</span><span class="p">(</span><span class="n">sBach</span><span class="o">.</span><span class="n">flat</span><span class="o">.</span><span class="n">getElementsByClass</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">Note</span><span class="p">))</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> <span class="mi">213</span>
</pre></div>
</div>
<p>Element offsets are always relative to the Stream that contains them.
For example, a Measure, when placed in a Stream, might have an offset of
16. This offset describes the position of the Measure in the Stream.
Components of this Measure, such as Notes, have offset values relative
only to their container, the Measure. The first Note of this Measure,
then, has an offset of 0. In the following example we find that the
offset of measure eight (using the
<a class="reference internal" href="../moduleReference/moduleBase.html#music21.base.Music21Object.getOffsetBySite" title="music21.base.Music21Object.getOffsetBySite"><code class="xref py py-meth docutils literal"><span class="pre">getOffsetBySite()</span></code></a> method) is 21; the
offset of the second Note in this Measure (index 1), however, is 1.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">m</span> <span class="o">=</span> <span class="n">sBach</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getElementsByClass</span><span class="p">(</span><span class="s">&#39;Measure&#39;</span><span class="p">)[</span><span class="mi">7</span><span class="p">]</span>
<span class="n">m</span><span class="o">.</span><span class="n">getOffsetBySite</span><span class="p">(</span><span class="n">sBach</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> <span class="mf">21.0</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">n</span> <span class="o">=</span> <span class="n">sBach</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">notes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">n</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> &lt;music21.note.Note B-&gt;
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">n</span><span class="o">.</span><span class="n">getOffsetBySite</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> <span class="mf">1.0</span>
</pre></div>
</div>
<p>Flattening a structure of nested Streams will set new, shifted offsets
for each of the elements on the Stream, reflecting their appropriate
position in the context of the Stream from which the <code class="docutils literal"><span class="pre">flat</span></code> property
was accessed. For example, if a flat version of the first part of the
Bach chorale is obtained, the note defined above has the appropriate
offset of 22 (the Measure offset of 21 plus the Note offset within this
Measure of 1).</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">pFlat</span> <span class="o">=</span> <span class="n">sBach</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flat</span>
<span class="n">indexN</span> <span class="o">=</span> <span class="n">pFlat</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">pFlat</span><span class="p">[</span><span class="n">indexN</span><span class="p">]</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> &lt;music21.note.Note B-&gt;
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">pFlat</span><span class="p">[</span><span class="n">indexN</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span>
</pre></div>
</div>
<div class="ipython-result highlight-python"><div class="highlight"><pre> <span class="mf">22.0</span>
</pre></div>
</div>
<p>As an aside, it is important to recognize that the offset of the Note
has not been edited; instead, a Note, as all Music21Objects, can store
multiple pairs of sites and offsets. Music21Objects retain an offset
relative to all Stream or Stream subclasses they are contained within,
even if just in passing.</p>
<p>There&#8217;s still a lot more to learn about <code class="docutils literal"><span class="pre">Streams</span></code>, but we can do that
later. For now, let&#8217;s move on to
<a class="reference internal" href="usersGuide_07_chords.html#usersguide-07-chords"><span>Chapter 7: Chords</span></a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="usersGuide_07_chords.html" title="User’s Guide, Chapter 7: Chords"
             >next</a> |</li>
        <li class="right" >
          <a href="usersGuide_05_listsOfLists.html" title="User’s Guide, Chapter 5: Lists of Lists, Functions, and Recursion"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">music21</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >User&#8217;s Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2006-2015, Michael Scott Cuthbert and cuthbertLab.
      Last updated on Sep 28, 2015.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>